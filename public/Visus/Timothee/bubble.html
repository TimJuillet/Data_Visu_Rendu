<!DOCTYPE html>
<html>
<head>
    <title>Map with Scaled Points</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }
        .country {
            fill: #cccccc;
            stroke: #333333;
            stroke-width: 0.5;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <div id="map"></div>
    
    <script>
        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
            
        const projection = d3.geoMercator()
            .scale(width / 6.2)
            .center([0, 20])
            .translate([width / 2, height / 2]);
            
        const path = d3.geoPath().projection(projection);
        
        // Définir une palette de couleurs
        const color = d3.scaleOrdinal()
            .domain(["Asia", "Europe", "Africa", "Americas", "Oceania"])
            .range(d3.schemeSet2);

        d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
            .then(function(data) {
                // Calculer la surface de chaque pays
                data.features.forEach(d => {
                    d.properties.area = path.area(d);
                });

                // Créer l'échelle pour la taille des cercles
                const valueExtent = d3.extent(data.features, d => d.properties.area);
                const size = d3.scaleSqrt()
                    .domain(valueExtent)
                    .range([2, 30]);  // Min et max taille des cercles en pixels

                // Dessiner les pays
                svg.selectAll("path")
                    .data(data.features)
                    .join("path")
                    .attr("class", "country")
                    .attr("d", path);

                // Ajouter les cercles
                svg.selectAll("circle")
                    .data(data.features.sort((a, b) => b.properties.area - a.properties.area))
                    .join("circle")
                    .attr("cx", d => path.centroid(d)[0])
                    .attr("cy", d => path.centroid(d)[1])
                    .attr("r", d => size(d.properties.area))
                    .style("fill", d => {
                        // Déterminer le continent basé sur le pays
                        let continent = "Other";
                        if (d.properties.name) {
                            const name = d.properties.name.toLowerCase();
                            if (name.includes("china") || name.includes("japan") || name.includes("india")) continent = "Asia";
                            else if (name.includes("france") || name.includes("germany") || name.includes("italy")) continent = "Europe";
                            else if (name.includes("nigeria") || name.includes("egypt") || name.includes("kenya")) continent = "Africa";
                            else if (name.includes("brazil") || name.includes("canada") || name.includes("united states")) continent = "Americas";
                            else if (name.includes("australia") || name.includes("zealand")) continent = "Oceania";
                        }
                        return color(continent);
                    })
                    .attr("stroke", d => d.properties.area > valueExtent[1]/3 ? "black" : "none")
                    .attr("stroke-width", 1)
                    .attr("fill-opacity", 0.4);

                // Gérer le redimensionnement
                window.addEventListener('resize', function() {
                    const width = window.innerWidth;
                    const height = window.innerHeight;
                    
                    svg.attr("width", width)
                       .attr("height", height);
                    
                    projection
                        .scale(width / 6.2)
                        .translate([width / 2, height / 2]);
                    
                    svg.selectAll("path")
                       .attr("d", path);
                    
                    // Mettre à jour la position des cercles
                    svg.selectAll("circle")
                       .attr("cx", d => path.centroid(d)[0])
                       .attr("cy", d => path.centroid(d)[1]);
                });
            });
    </script>
</body>
</html>